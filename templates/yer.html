<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Lodos TELEMETRƒ∞ Sƒ∞STEMƒ∞</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        /* ...stil kodlarƒ±n aynƒ± ≈üekilde bƒ±rakƒ±ldƒ±... */
        body { margin: 0; background: #121F2B; color: #E1E9F0; font-family: 'Segoe UI', Arial, sans-serif; }
        .container { display: flex; flex-direction: row; height: 100vh; width: 100vw; }
        .left-panel { flex: 2.5; display: flex; flex-direction: column; padding: 0; position: relative; }
        #map { flex: 1; min-height: 500px; min-width: 900px; height: 100%; }
        .right-panel { flex: 1; background: #19202A; display: flex; flex-direction: column; align-items: center; padding: 20px 10px 10px 10px; min-width: 400px; }
        .connection-status { background: #dc2626; color: white; padding: 8px 16px; border-radius: 4px; margin-bottom: 16px; font-size: 14px; font-weight: bold; }
        .connection-status.connected { background: #059669; }
        .gauges { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .gauge { width: 120px; height: 120px; background: #222; border-radius: 50%; margin: 5px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        .gauge.updating { box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); }
        .telemetry-panel, .console-panel { background: #1F2937; color: #E1E9F0; border-radius: 8px; padding: 16px; margin-top: 16px; width: 95%; font-size: 16px; min-height: 80px; }
        .console-panel { min-height: 120px; font-size: 15px; overflow-y: auto; max-height: 200px; }
        .data-field { margin: 4px 0; padding: 2px 0; }
        .data-label { color: #9CA3AF; font-weight: 500; }
        .data-value { color: #F3F4F6; font-weight: bold; }
        
        .control-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(75, 85, 99, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin-bottom: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .control-button:last-child {
            margin-bottom: 0;
        }
        
        .control-button.goto {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 3px 12px rgba(40, 167, 69, 0.4);
        }
        
        .control-button.goto:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(40, 167, 69, 0.6);
        }
        
        .control-button.home {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 3px 12px rgba(102, 126, 234, 0.4);
        }
        
        .control-button.home:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(102, 126, 234, 0.6);
        }
        
        .control-button.rtl {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 3px 12px rgba(231, 76, 60, 0.4);
        }
        
        .control-button.rtl:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(231, 76, 60, 0.6);
        }
        
        .control-button.deploy {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            box-shadow: 0 3px 12px rgba(243, 156, 18, 0.4);
        }
        
        .control-button.deploy:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(243, 156, 18, 0.6);
        }
        
        .control-button.track {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            box-shadow: 0 3px 12px rgba(155, 89, 182, 0.4);
        }
        
        .control-button.track:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(155, 89, 182, 0.6);
        }
        
        .control-button.track.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            box-shadow: 0 3px 12px rgba(39, 174, 96, 0.4);
        }
        
        .control-button:active {
            transform: translateY(0);
        }
        
        .control-button:disabled {
            background: #6B7280;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
<div class="container">
    <div class="left-panel">
        <div class="control-panel">
            <button id="goto-location-btn" class="control-button goto">üìç Konuma Git</button>
            <button id="track-btn" class="control-button track">üéØ Takip Et</button>
            <button id="set-home-btn" class="control-button home">üè† Tƒ±klanan Noktaya Git</button>
            <button id="deploy-btn" class="control-button deploy">üï∏Ô∏è Aƒü Yay</button>
            <button id="rtl-btn" class="control-button rtl">üè† Base'e D√∂n</button>
        </div>
        <div id="map"></div>
    </div>
    <div class="right-panel">
        <div class="connection-status" id="connection-status">
            Mission Planner: BAƒûLANTI BEKLENƒ∞YOR
        </div>
        
        <div class="gauges">
            <!-- ...gauge kodlarƒ±n aynƒ± ≈üekilde bƒ±rakƒ±ldƒ±... -->
            <div class="gauge" style="background: radial-gradient(circle, #2C3E50 0%, #34495E 100%); border: 3px solid #3498DB;">
                <div style="text-align: center; color: #ECF0F1;">
                    <div style="font-size: 12px; margin-bottom: 5px;">HAVA HIZI</div>
                    <div style="font-size: 18px; font-weight: bold;" id="airspeed-value">0.00</div>
                    <div style="font-size: 10px;">km/h</div>
                </div>
            </div>
            <div class="gauge" style="background: radial-gradient(circle, #2C3E50 0%, #34495E 100%); border: 3px solid #E74C3C;">
                <div style="text-align: center; color: #ECF0F1;">
                    <div style="font-size: 12px; margin-bottom: 5px;">ƒ∞RTƒ∞FA</div>
                    <div style="font-size: 18px, font-weight: bold;" id="altitude-value">0.00</div>
                    <div style="font-size: 10px;">m</div>
                </div>
            </div>
            <div class="gauge" style="background: radial-gradient(circle, #2C3E50 0%, #34495E 100%); border: 3px solid #F39C12;">
                <div style="text-align: center; color: #ECF0F1;">
                    <div style="font-size: 12px; margin-bottom: 5px;">YER HIZI</div>
                    <div style="font-size: 18px, font-weight: bold;" id="groundspeed-value">0.00</div>
                    <div style="font-size: 10px;">km/h</div>
                </div>
            </div>
            <div class="gauge" style="background: radial-gradient(circle, #2C3E50 0%, #34495E 100%); border: 3px solid #9B59B6;">
                <div style="text-align: center; color: #ECF0F1;">
                    <div style="font-size: 12px; margin-bottom: 5px;">YAW</div>
                    <div style="font-size: 18px, font-weight: bold;" id="yaw-value">0.00¬∞</div>
                </div>
            </div>
            <div class="gauge" style="background: radial-gradient(circle, #2C3E50 0%, #34495E 100%); border: 3px solid #1ABC9C;">
                <div style="text-align: center; color: #ECF0F1;">
                    <div style="font-size: 12px; margin-bottom: 5px;">PITCH</div>
                    <div style="font-size: 18px, font-weight: bold;" id="pitch-value">0.00¬∞</div>
                </div>
            </div>
            <div class="gauge" style="background: radial-gradient(circle, #2C3E50 0%, #34495E 100%); border: 3px solid #E67E22;">
                <div style="text-align: center; color: #ECF0F1;">
                    <div style="font-size: 12px; margin-bottom: 5px;">ROLL</div>
                    <div style="font-size: 18px, font-weight: bold;" id="roll-value">0.00¬∞</div>
                </div>
            </div>
        </div>
        
        <div class="telemetry-panel" id="telemetry-panel">
            <div class="data-field">
                <span class="data-label">U√ßu≈ü Modu:</span> 
                <span class="data-value" id="telemetry-flightmode" style="color: #F39C12; font-weight: bold;">UNKNOWN</span>
            </div>
            <div class="data-field">
                <span class="data-label">Air Speed:</span> 
                <span class="data-value" id="telemetry-airspeed">0.00 km/h</span>
            </div>
            <div class="data-field">
                <span class="data-label">Altitude:</span> 
                <span class="data-value" id="telemetry-altitude">0.00 m</span>
            </div>
            <div class="data-field">
                <span class="data-label">Ground Speed:</span> 
                <span class="data-value" id="telemetry-groundspeed">0.00 km/h</span>
            </div>
            <div class="data-field">
                <span class="data-label">Lat:</span> 
                <span class="data-value" id="telemetry-lat">0.000000</span> | 
                <span class="data-label">Lon:</span> 
                <span class="data-value" id="telemetry-lon">0.000000</span>
            </div>
            <div class="data-field">
                <span class="data-label">Yaw:</span> 
                <span class="data-value" id="telemetry-yaw">0.00¬∞</span>
            </div>
            <div class="data-field">
                <span class="data-label">Pitch:</span> 
                <span class="data-value" id="telemetry-pitch">0.00¬∞</span>
            </div>
            <div class="data-field">
                <span class="data-label">Roll:</span> 
                <span class="data-value" id="telemetry-roll">0.00¬∞</span>
            </div>
            <div class="data-field">
                <span class="data-label">Sinyal Kalitesi:</span> 
                <span class="data-value" id="telemetry-signal">0</span> | 
                <span class="data-label">Batarya:</span> 
                <span class="data-value" id="telemetry-battery">0%</span>
            </div>
        </div>
        
        <div class="console-panel" id="console-panel">
            <div>&gt; Telemetri sistemi ba≈ülatƒ±lƒ±yor...</div>
            <div>&gt; Mission Planner baƒülantƒ±sƒ± bekleniyor...</div>
        </div>
    </div>
</div>

<script>
    // Global deƒüi≈ükenler
    let map;
    let aircraftMarker = null;
    let isTracking = false; // Takip modu
    let telemetryData = {
        airspeed: 0,
        altitude: 0,
        groundspeed: 0,
        latitude: 40.2376335,
        longitude: 29.0081634,
        yaw: 0,
        pitch: 0,
        roll: 0,
        signalQuality: 0,
        battery: 0,
        flight_mode: "UNKNOWN",
        koordinatlar: [] // <-- Python'dan gelen koordinatlar dizisi
    };
    let websocket;
    let reconnectInterval;
    let httpPollingInterval;
    let positionMarkers = []; // Nokta markerlarƒ±
    let waypointMarkers = []; // Waypoint markerlarƒ±
    let waypointLine = null; // Waypoint √ßizgisi
    let lastClickedCoord = null;

    // Harita ba≈ülatma
    function initializeMap() {
        map = L.map('map').setView([telemetryData.latitude, telemetryData.longitude], 16);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map);

        // Sadece bir u√ßak i≈üaret√ßisi (img ile)
        const aircraftIcon = L.divIcon({
            html: `<img src="http://localhost:8000/enemy.png" style="width:30px;height:30px;transform:rotate(${Number(telemetryData.yaw.toFixed(2))}deg);" />`,
            iconSize: [30, 30],
            iconAnchor: [15, 15],
            className: ""
        });
        aircraftMarker = L.marker([telemetryData.latitude, telemetryData.longitude], {icon: aircraftIcon}).addTo(map);

        // Konum i≈üaret√ßileri ba≈üta bo≈ü
        positionMarkers = [];

        // Haritaya tƒ±klayƒ±nca koordinat g√∂nder
        map.on('click', function(e) {
            const lat = e.latlng.lat;
            const lon = e.latlng.lng;
            lastClickedCoord = {lat, lon}; // Son tƒ±klananƒ± sakla

            // Noktayƒ± anlƒ±k g√∂ster (isteƒüe baƒülƒ±)
            L.marker([lat, lon], {
                icon: L.divIcon({
                    html: `<div style="width:12px;height:12px;background:blue;border-radius:50%;border:2px solid white;"></div>`,
                    iconSize: [12, 12],
                    iconAnchor: [6, 6],
                    className: ""
                })
            }).addTo(map);

            // Sadece koordinat ekle (set_home olmadan)
            fetch('http://localhost:8001/api/koordinat_ekle', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({lat: lat, lon: lon})
            })
            .then(res => res.json())
            .then(data => addConsoleMessage('Koordinat eklendi: ' + JSON.stringify(data)))
            .catch(err => addConsoleMessage('Koordinat ekleme hatasƒ±: ' + err));
        });

        // Home butonu
        document.getElementById('set-home-btn').onclick = function() {
            if (!lastClickedCoord) {
                addConsoleMessage('√ñnce haritadan bir nokta se√ßin.');
                return;
            }
            fetch('http://localhost:8001/api/koordinat_ekle', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({lat: lastClickedCoord.lat, lon: lastClickedCoord.lon, set_home: true})
            })
            .then(res => res.json())
            .then(data => addConsoleMessage('Home ayarlandƒ±, GUIDED modda hedefe gidiyor...'))
            .catch(err => addConsoleMessage('Home noktasƒ± ayarlanamadƒ±: ' + err));
        };
        
        // Konuma git butonu
        document.getElementById('goto-location-btn').onclick = function() {
            if (telemetryData.latitude && telemetryData.longitude) {
                map.setView([telemetryData.latitude, telemetryData.longitude], 16);
                addConsoleMessage('U√ßaƒüƒ±n konumuna gidildi');
            } else {
                addConsoleMessage('U√ßak konumu bulunamadƒ±');
            }
        };
        
        // RTL butonu
        document.getElementById('rtl-btn').onclick = function() {
            fetch('http://localhost:8001/api/koordinat_ekle', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({rtl: true})
            })
            .then(res => res.json())
            .then(data => addConsoleMessage('Manuel RTL komutu g√∂nderildi'))
            .catch(err => addConsoleMessage('RTL komutu g√∂nderilemedi: ' + err));
        };
        
        // Aƒü yay butonu
        document.getElementById('deploy-btn').onclick = function() {
            fetch('http://localhost:8001/api/ag_yay', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({})
            })
            .then(res => res.json())
            .then(data => addConsoleMessage('Aƒü yayma komutu g√∂nderildi'))
            .catch(err => addConsoleMessage('Aƒü yayma komutu g√∂nderilemedi: ' + err));
        };
        
        // Takip butonu
        document.getElementById('track-btn').onclick = function() {
            isTracking = !isTracking;
            const trackBtn = document.getElementById('track-btn');
            
            if (isTracking) {
                trackBtn.classList.add('active');
                trackBtn.textContent = 'üéØ Takip Aktif';
                addConsoleMessage('U√ßak takip modu aktif');
                // Hemen u√ßaƒüƒ±n konumuna git
                if (telemetryData.latitude && telemetryData.longitude) {
                    map.setView([telemetryData.latitude, telemetryData.longitude], map.getZoom());
                }
            } else {
                trackBtn.classList.remove('active');
                trackBtn.textContent = 'üéØ Takip Et';
                addConsoleMessage('U√ßak takip modu pasif');
            }
        };
    }

    // WebSocket baƒülantƒ±sƒ±
    function connectToMissionPlanner() {
        try {
            websocket = new WebSocket('ws://localhost:8080/telemetry');

            websocket.onopen = function(event) {
                updateConnectionStatus(true);
                addConsoleMessage('Mission Planner baƒülantƒ±sƒ± ba≈üarƒ±lƒ±');
                clearInterval(reconnectInterval);
                // HTTP polling'i durdurmak yerine ba≈ülat:
                if (!httpPollingInterval) {
                    httpPollingInterval = setInterval(fetchTelemetryHTTP, 1000);
                }
            };

            websocket.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    updateTelemetryData(data); // Her yeni veri geldiƒüinde aray√ºz g√ºncellenir
                } catch (e) {
                    console.error('Telemetri verisi parse hatasƒ±:', e);
                }
            };

            websocket.onclose = function(event) {
                updateConnectionStatus(false);
                addConsoleMessage('Mission Planner baƒülantƒ±sƒ± kesildi');
                scheduleReconnect();
                // WebSocket kapandƒ±ysa HTTP polling ba≈ülat
                if (!httpPollingInterval) {
                    httpPollingInterval = setInterval(fetchTelemetryHTTP, 1000);
                }
            };

            websocket.onerror = function(error) {
                updateConnectionStatus(false);
                addConsoleMessage('Baƒülantƒ± hatasƒ±: ' + error.message);
                // Hata durumunda HTTP polling ba≈ülat
                if (!httpPollingInterval) {
                    httpPollingInterval = setInterval(fetchTelemetryHTTP, 1000);
                }
            };

        } catch (error) {
            updateConnectionStatus(false);
            addConsoleMessage('WebSocket baƒülantƒ± hatasƒ±');
            scheduleReconnect();
            // Baƒülantƒ± hatasƒ±nda HTTP polling ba≈ülat
            if (!httpPollingInterval) {
                httpPollingInterval = setInterval(fetchTelemetryHTTP, 1000);
            }
        }
    }

    // HTTP API ile veri √ßekme (alternatif)
    function fetchTelemetryHTTP() {
        fetch('/api/telemetry')
            .then(response => response.json())
            .then(data => updateTelemetryData(data))
            .catch(error => {
                console.error('HTTP telemetri hatasƒ±:', error);
                addConsoleMessage('HTTP API hatasƒ±: ' + error.message);
            });
    }

    // Telemetri verilerini g√ºncelleme
    function updateTelemetryData(data) {
        // Veri g√ºncellemesi
        telemetryData = { ...telemetryData, ...data };

        // Baƒülantƒ± durumunu g√ºncel veri geldik√ße BAƒûLI yap
        updateConnectionStatus(true);

        // Gauge deƒüerlerini g√ºncelle
        updateGauges();
        
        // Telemetri panelini g√ºncelle
        updateTelemetryPanel();
        
        // Haritada u√ßak pozisyonunu g√ºncelle
        updateAircraftPosition();
        
        // Gauge animasyonu
        animateGauges();
    }

    // Gauge deƒüerlerini g√ºncelleme
    function updateGauges() {
        document.getElementById('airspeed-value').textContent = telemetryData.airspeed.toFixed(2);
        document.getElementById('altitude-value').textContent = telemetryData.altitude.toFixed(2);
        document.getElementById('groundspeed-value').textContent = telemetryData.groundspeed.toFixed(2);
        document.getElementById('yaw-value').textContent = telemetryData.yaw.toFixed(2) + '¬∞';
        document.getElementById('pitch-value').textContent = telemetryData.pitch.toFixed(2) + '¬∞';
        document.getElementById('roll-value').textContent = telemetryData.roll.toFixed(2) + '¬∞';
    }

    // Telemetri panelini g√ºncelleme
    function updateTelemetryPanel() {
        document.getElementById('telemetry-flightmode').textContent = telemetryData.flight_mode || 'UNKNOWN';
        document.getElementById('telemetry-airspeed').textContent = telemetryData.airspeed.toFixed(2) + ' km/h';
        document.getElementById('telemetry-altitude').textContent = telemetryData.altitude.toFixed(2) + ' m';
        document.getElementById('telemetry-groundspeed').textContent = telemetryData.groundspeed.toFixed(2) + ' km/h';
        document.getElementById('telemetry-lat').textContent = telemetryData.latitude.toFixed(7);
        document.getElementById('telemetry-lon').textContent = telemetryData.longitude.toFixed(7);
        document.getElementById('telemetry-yaw').textContent = telemetryData.yaw.toFixed(2) + '¬∞';
        document.getElementById('telemetry-pitch').textContent = telemetryData.pitch.toFixed(2) + '¬∞';
        document.getElementById('telemetry-roll').textContent = telemetryData.roll.toFixed(2) + '¬∞';
        document.getElementById('telemetry-signal').textContent = telemetryData.signalQuality;
        document.getElementById('telemetry-battery').textContent = telemetryData.battery + '%';

    }

    // U√ßak pozisyonunu g√ºncelleme
    function updateAircraftPosition() {
        if (aircraftMarker && telemetryData.latitude && telemetryData.longitude) {
            const newLatLng = [telemetryData.latitude, telemetryData.longitude];
            aircraftMarker.setLatLng(newLatLng);

            // Takip modu aktifse haritayƒ± u√ßaƒüƒ±n konumuna odakla
            if (isTracking) {
                map.setView(newLatLng, map.getZoom(), {
                    animate: true,
                    duration: 0.5
                });
            }

            // U√ßak g√∂rselini yaw a√ßƒ±sƒ±na g√∂re d√∂nd√ºr (img ile)
            const rotation = Number(telemetryData.yaw.toFixed(2));
            const rotatedIcon = L.divIcon({
                html: `<img src="http://localhost:8000/enemy.png" style="width:30px;height:30px;transform:rotate(${rotation}deg);" />`,
                iconSize: [30, 30],
                iconAnchor: [15, 15],
                className: ""
            });
            aircraftMarker.setIcon(rotatedIcon);

            // --- Nokta markerlarƒ±nƒ± g√ºncelle ---
            // √ñnce eski markerlarƒ± kaldƒ±r
            positionMarkers.forEach(marker => map.removeLayer(marker));
            positionMarkers = [];

            // Python'dan gelen koordinatlar dizisini i≈üle
            if (Array.isArray(telemetryData.koordinatlar)) {
                telemetryData.koordinatlar.forEach(coord => {
                    if (coord && typeof coord.lat === "number" && typeof coord.lon === "number") {
                        const marker = L.marker([coord.lat, coord.lon], {
                            icon: L.divIcon({
                                html: `<div style="width:12px;height:12px;background:red;border-radius:50%;border:2px solid white;"></div>`,
                                iconSize: [12, 12],
                                iconAnchor: [6, 6],
                                className: ""
                            })
                        }).addTo(map);
                        positionMarkers.push(marker);
                    }
                });
            }

            // --- Waypoint markerlarƒ±nƒ± g√ºncelle ---
            // √ñnce eski waypoint markerlarƒ±nƒ± kaldƒ±r
            waypointMarkers.forEach(marker => map.removeLayer(marker));
            waypointMarkers = [];
            
            // Eski √ßizgiyi kaldƒ±r
            if (waypointLine) {
                map.removeLayer(waypointLine);
                waypointLine = null;
            }

            // Waypoints'leri i≈üle
            if (Array.isArray(telemetryData.waypoints)) {
                const waypointCoords = [];
                
                telemetryData.waypoints.forEach((waypoint, index) => {
                    if (waypoint && waypoint.length >= 2) {
                        const lat = waypoint[0];
                        const lon = waypoint[1];
                        
                        // Sƒ±ralƒ± marker olu≈ütur
                        const marker = L.marker([lat, lon], {
                            icon: L.divIcon({
                                html: `<div style="width:24px;height:24px;background:#2196F3;border-radius:50%;border:2px solid white;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:12px;">${index + 1}</div>`,
                                iconSize: [24, 24],
                                iconAnchor: [12, 12],
                                className: ""
                            })
                        }).addTo(map);
                        
                        waypointMarkers.push(marker);
                        waypointCoords.push([lat, lon]);
                    }
                });
                
                // Waypoint'leri √ßizgi ile baƒüla
                if (waypointCoords.length > 1) {
                    waypointLine = L.polyline(waypointCoords, {
                        color: '#2196F3',
                        weight: 3,
                        opacity: 0.8,
                        dashArray: '5, 5'
                    }).addTo(map);
                }
            }
        }
    }

    // Baƒülantƒ± durumunu g√ºncelleme
    function updateConnectionStatus(connected) {
        const statusElement = document.getElementById('connection-status');
        if (connected) {
            statusElement.textContent = 'Mission Planner: BAƒûLI';
            statusElement.className = 'connection-status connected';
        } else {
            statusElement.textContent = 'Mission Planner: BAƒûLANTI KESƒ∞K';
            statusElement.className = 'connection-status';
        }
    }

    // Konsol mesajƒ± ekleme
    function addConsoleMessage(message) {
        const consolePanel = document.getElementById('console-panel');
        const timestamp = new Date().toLocaleTimeString();
        const messageDiv = document.createElement('div');
        messageDiv.innerHTML = `<span style="color: #6B7280;">[${timestamp}]</span> ${message}`;
        consolePanel.appendChild(messageDiv);
        consolePanel.scrollTop = consolePanel.scrollHeight;
    }

    // Yeniden baƒülanma zamanlamasƒ±
    function scheduleReconnect() {
        if (reconnectInterval) clearInterval(reconnectInterval);
        reconnectInterval = setInterval(() => {
            addConsoleMessage('Yeniden baƒülanmaya √ßalƒ±≈üƒ±lƒ±yor...');
            connectToMissionPlanner();
        }, 5000);
    }

    // Gauge animasyonu
    function animateGauges() {
        document.querySelectorAll('.gauge').forEach(gauge => {
            gauge.classList.add('updating');
            setTimeout(() => gauge.classList.remove('updating'), 300);
        });
    }

    // Sayfa y√ºklendiƒüinde ba≈ülatma
    window.addEventListener('load', function() {
        initializeMap();
        addConsoleMessage('Telemetri sistemi ba≈ülatƒ±ldƒ±');
        connectToMissionPlanner();
        // setInterval(fetchTelemetryHTTP, 1000); // <-- Burasƒ± kaldƒ±rƒ±ldƒ±
        // Test verisi (geli≈ütirme i√ßin)
        // setInterval(() => {
        //     const testData = {
        //         airspeed: 20 + Math.random() * 10,
        //         altitude: 100 + Math.random() * 50,
        //         groundspeed: 22 + Math.random() * 8,
        //         yaw: Math.random() * 360,
        //         pitch: -5 + Math.random() * 10,
        //         roll: -3 + Math.random() * 6,
        //         signalQuality: Math.floor(Math.random() * 100),
        //         battery: 75 + Math.random() * 25
        //     };
        //     updateTelemetryData(testData);
        // }, 2000);
    });
</script>
</body>
</html>